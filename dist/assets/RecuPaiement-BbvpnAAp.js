import{d as j,g as P,j as e,e as T,f as y,a as I,B as N,b as p,P as w,D as S}from"./index-JJeUicGD.js";function E(n){let t=n.receipt;if(!t&&n.montantRegle!=null){const s=n.eleve||{},g=n.numeroRecu||n.notes||"Paiement",l=Number(n.montantRegle||0);t={id:String(n.numeroRecu||"tmp-"+Date.now()),numero:n.numeroRecu,eleve:{nom:s.nom||"",prenoms:s.prenoms||"",matricule:s.matricule||"",classe:s.classe||""},payeur:n.payeur||s.nom||"",items:[{description:g,montant:l}],montantTotal:l,date:n.date,paiementType:n.mode,user:n.operateur||n.user,notes:n.notes||""};try{const r=j.getAll("paiements").find(a=>a.numeroRecu===t.numero||a.datePaiement===t.date||a.eleveId&&a.eleveId===s.id);if(r&&r.allocations&&Array.isArray(r.allocations)&&r.allocations.length>0){const a=r.allocations.map(i=>{let o=null;return i&&i.echeanceId&&(o=j.getById("echeances",i.echeanceId),o||(o=j.getAll("echeances").find(f=>f.echeanceId===i.echeanceId||f.echeanceId===i.echeanceId))),{description:o?.label?.trim()||(i.description?i.description.trim():"")||(i.modalite?`Modalité ${i.modalite}`:"Paiement"),montant:i.montant||0}});t.items=a,t.montantTotal=a.reduce((i,o)=>i+(o.montant||0),0)}}catch{}}const R=n.entete,A=P("recu"),h=R||A||{};if(!t)return e.jsx("div",{className:"p-4 text-sm text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:"Aucun reçu à afficher"});const m=s=>s.toLocaleString("fr-FR"),d=(()=>{try{const s=t?.eleve?.id||n.eleve?.id;return s?T.getSituationEcheances(s):null}catch{return null}})(),b=Number(n.totalPaye??n.cumulReglement??(d?d.totalPaye:NaN));let u=n.totalRestant??n.resteAPayer??(d?d.totalRestant:void 0),c=n.totalAttendu??n.totalDu??(d?d.totalDu:void 0);const x=Number.isFinite(b)?b:t?Number(t.montantTotal||0):0;c==null&&(u!=null?c=x+Number(u):d?c=d.totalDu:c=x||(t?t.montantTotal:0)),u==null&&(u=Math.max(0,Number(c||0)-Number(x||0)));const v=Number(u||0),F=Number(v||0)===0;return e.jsxs("div",{id:t.id,className:"receipt-compact recu simple-recu bg-white border border-gray-300 rounded-md p-4 relative","data-recu-id":t.id,style:{minHeight:"320px",boxSizing:"border-box"},children:[F?e.jsx("div",{style:{position:"absolute",top:12,right:12,background:"#059669",color:"white",padding:"6px 12px",borderRadius:8,fontSize:12,fontWeight:700,zIndex:10,boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},children:"SOLDÉ"}):null,e.jsxs("div",{className:"entete flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-base font-bold entete-libelle",children:h.etablissement||h.header||"Votre École"}),e.jsx("div",{className:"text-xs",children:"Reçu de paiement"})]}),e.jsx("div",{className:"text-right",children:h.logo?e.jsx("img",{src:h.logo,alt:"logo",style:{height:48,objectFit:"contain"}}):null})]}),e.jsxs("div",{className:"student-row mb-3 flex justify-between text-xs",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Élève :"})," ",y(t.eleve)," ",t.eleve.matricule?`(${t.eleve.matricule})`:""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Classe :"})," ",t.eleve.classe||"—"]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Mode :"})," ",t.paiementType||"Espèces"]}),e.jsx("div",{className:"mt-1",children:t.date?new Date(t.date).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""})]})]}),e.jsx("div",{className:"items mb-3 text-xs",style:{maxHeight:"none",overflowY:"visible"},children:t.items.map((s,g)=>{const l=s.description.match(/^(\d{2}\/\d{2}\/\d{4})(?: (\d{2}:\d{2}))? · /),r=l?l[1]:"",a=l&&l[2]?l[2]:"";return l?s.description.replace(/^(\d{2}\/\d{2}\/\d{4})(?: \d{2}:\d{2})? · /,""):s.description,e.jsxs("div",{style:{padding:"2px 0",fontWeight:600,fontSize:14,lineHeight:"1.3"},children:[r&&e.jsx("span",{style:{marginRight:8},children:r}),a&&e.jsx("span",{style:{marginRight:8},children:a}),"Paiement : ",e.jsxs("span",{style:{fontWeight:700,marginLeft:4},children:[m(s.montant)," FCFA"]})]},g)})}),e.jsx("div",{className:"summary-box mb-4 text-xs",style:{borderTop:"1px solid #ddd",paddingTop:8},children:e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total attendu:"})," ",e.jsxs("span",{className:"font-bold",children:[m(Number(c||0))," FCFA"]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total cumulé payé:"})," ",e.jsxs("span",{className:"font-bold",children:[m(Number(x||0))," FCFA"]})]}),e.jsxs("div",{className:"print-deadline",children:[e.jsx("strong",{children:"Reste à payer:"})," ",e.jsxs("span",{className:"font-bold",children:[m(Number(v||0))," FCFA"]})]})]})}),e.jsxs("div",{className:"total text-right text-sm font-bold mb-3 print-important",style:{fontSize:"1.1rem"},children:["TOTAL — ",e.jsxs("span",{className:"font-bold",children:[m(t.montantTotal)," FCFA"]})]}),e.jsx("div",{className:"mt-2 text-xs text-left",children:e.jsxs("div",{children:[e.jsx("strong",{children:"Opérateur :"})," ",e.jsx("span",{className:"font-bold",children:t.user||n.user||(()=>{const s=I();return s?y(s):"ADMIN"})()})]})}),e.jsxs("div",{className:"mt-4 flex gap-3 justify-end",children:[e.jsxs(N,{variant:"secondary",onClick:()=>p(t.id,"Aperçu reçu",!1),children:[e.jsx(w,{className:"h-4 w-4"})," Aperçu"]}),e.jsxs(N,{onClick:()=>p(t.id,"Imprimer reçu (2/page)",!0),children:[e.jsx(S,{className:"h-4 w-4"})," Imprimer 2/page"]})]})]})}export{E as default};
