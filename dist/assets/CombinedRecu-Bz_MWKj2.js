import{e as N,g as $,j as a}from"./index-BDXXLEuH.js";import I from"./RecuPaiement-tZqriSF0.js";function E({receipts:y=[],eleve:r,paiements:h,classe:g,totalAttendu:v,title:T="Reçus de Paiement"}){let d=[];if(Array.isArray(y)&&y.length>0)d=y;else if(Array.isArray(h)&&h.length>0){const n=new Map;h.forEach(e=>{const i=e.eleveId||e.eleveMatricule||`${e.eleveNom||""}|${e.elevePrenoms||""}`,c=e.montant||e.montantTtc||0,u=e.modePaiement||e.paiementType||"Espèces",f=e.datePaiement||e.createdAt,b=e.nbEcheances||e.nombreEcheances||1;let s="";try{const t=e.eleveId?N.getSituationEcheances(e.eleveId):null;if(t){if(Array.isArray(e.allocations)&&e.allocations.length>0){const l=e.allocations.map(o=>{const m=(t.echeances||[]).find(j=>j.echeanceId===o.echeanceId||j.echeanceId===`${t.classe&&t.classe.niveau||""}-${o.modalite}`);return m?m.label:o.label||""}).filter(Boolean);l.length>0&&(s=l.join(" · "))}if(!s){let l=null;if(e.modalite?l=Number(e.modalite):e.versementIndex!=null?l=Number(e.versementIndex)+1:e.typeFrais==="inscription"&&(l=1),l){const o=(t.echeances||[]).find(m=>Number(m.modalite)===Number(l));o&&(s=o.label||"")}if(!s){const o=(t.echeances||[]).find(m=>Number(m.montant)===Number(c));o&&(s=o.label||"")}}}}catch{}s||(s=e.notes||e.numeroRecu||`Règlement de ${b} échéance(s)`);const A=`${s}${" - "+u}`,x={description:`${f?new Date(f).toLocaleDateString("fr-FR")+" · ":""}${A}`,montant:c};if(!n.has(i))n.set(i,{eleve:{id:e.eleveId,nom:e.eleveNom||e.eleve?.nom||(r?r.nom:"")||"",prenoms:e.elevePrenoms||e.eleve?.prenoms||(r?r.prenoms:"")||"",matricule:e.eleveMatricule||e.eleve?.matricule||(r?r.matricule:"")||"",classe:g?`${g.niveau||""} ${g.section||""}`:e.classe||e.classeNom||""},payeur:e.payeur||e.nomPayeur,paiementType:u,items:[x],montantTotal:c,ids:[e.id]});else{const t=n.get(i);t.items.push(x),t.montantTotal=(t.montantTotal||0)+c,t.ids.push(e.id)}}),d=Array.from(n.values()).map(e=>({id:e.ids&&e.ids[0]||String(Math.random()).slice(2),numero:void 0,eleve:e.eleve,payeur:e.payeur,items:e.items,montantTotal:e.montantTotal,date:void 0,paiementType:e.paiementType,user:void 0,notes:void 0}))}const p=[];for(let n=0;n<d.length;n+=2)p.push([d[n],d[n+1]].filter(Boolean));const w=$("recu");return a.jsxs("div",{className:"combined-recu-root",children:[a.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:12},children:a.jsx("h2",{style:{margin:0},children:T})}),a.jsxs("div",{id:"combined-print-area",children:[p.length===0&&a.jsx("div",{style:{padding:24},children:"Aucun reçu"}),p.map((n,e)=>a.jsx("div",{className:"print-page-two-up",style:{padding:8},children:a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(i=>{const c=typeof v=="number"?v:i.montantTotal,u=i.montantTotal,f=Math.max(0,(c||0)-u),b={receipt:i,totalAttendu:c,totalPaye:u,totalRestant:f,entete:w,eleve:i.eleve||r};return a.jsx("div",{style:{marginBottom:6},children:a.jsx(I,{...b})},i.id)})})},e))]}),a.jsx("style",{children:`
        @media print {
          body > *:not(#combined-print-area):not(script):not(style) { display: none !important; }
          #combined-print-area { width: 210mm; margin: 0 auto; }
          .print-page-two-up { min-height: 297mm; display: flex; flex-direction: column; justify-content: space-between; page-break-after: always; }
          .print-page-two-up:last-child { page-break-after: auto; }
          .print-page-two-up > div { height: 100%; display:flex; flex-direction:column; justify-content:space-between; }
          .receipt-compact { page-break-inside: avoid; }
        }
      `})]})}export{E as default};
